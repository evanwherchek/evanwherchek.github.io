import { useEffect, useRef, useState } from 'react';

function Signature() {
    const svgRef = useRef(null);
    const [totalLength, setTotalLength] = useState(0);
    const [hasAnimated, setHasAnimated] = useState(false);

    useEffect(() => {
        if (svgRef.current) {
            const paths = svgRef.current.querySelectorAll('path');
            let total = 0;
            paths.forEach(path => {
                const length = path.getTotalLength();
                total += length;
                // Set initial state - path is hidden
                path.style.strokeDasharray = `${length}`;
                path.style.strokeDashoffset = `${length}`;
            });
            setTotalLength(total);

            // Create intersection observer to detect when component comes into view
            const observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        if (entry.isIntersecting && !hasAnimated) {
                            setHasAnimated(true);
                            // Start animation after a brief delay to ensure styles are applied
                            setTimeout(() => {
                                paths.forEach((path, index) => {
                                    path.style.animation = `LineAnimation 3s ease-out forwards`;
                                    path.style.animationDelay = `${0.5 + (index * 0.3)}s`;
                                });
                            }, 50);
                        }
                    });
                },
                {
                    threshold: 0.1, // Trigger when 10% of the element is visible
                    rootMargin: '0px 0px -50px 0px' // Trigger slightly before fully in view
                }
            );

            observer.observe(svgRef.current);

            // Cleanup observer on unmount
            return () => {
                if (svgRef.current) {
                    observer.unobserve(svgRef.current);
                }
            };
        }
    }, [hasAnimated]);

    return (
        <div>
            <style>{`
                @keyframes LineAnimation {
                    to {
                        stroke-dashoffset: 0;
                        animation-iteration-count: 1;
                    }
                }
                .signature-svg {
                    width: 100%;
                    height: auto;
                }
                .signature-svg path {
                    fill: none;
                    stroke: black;
                    stroke-width: 8;
                    stroke-linecap: round;
                }
            `}</style>
            <svg ref={svgRef} className="signature-svg" width="467" height="257" viewBox="0 0 467 257" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M85.9292 8.45782C80.8538 7.36162 70.6044 5.91464 61.484 5.3501C54.1186 4.89419 46.8608 6.98892 41.9169 9.18131C36.9644 11.3775 32.2375 12.4699 27.6664 15.024C22.0444 18.1653 18.7105 23.7826 14.6929 27.992C12.8038 29.9713 11.3879 33.2757 10.1163 38.0386C8.7456 43.1729 7.00313 49.3459 6.09329 57.7373C3.84397 78.4825 7.00313 85.1476 9.91353 94.2954C11.7751 100.147 13.2076 108.168 15.9426 115.852C19.9592 127.137 22.7006 135.2 25.4466 141.081C27.558 145.603 31.4702 149.845 36.3976 153.325C41.2784 156.773 45.348 159.36 49.9192 160.823C52.6098 161.685 55.2248 161.563 57.4117 160.834C61.7603 159.385 65.803 154.997 69.2944 150.799C73.2364 146.059 71.3059 138.927 70.5879 134.537C69.841 129.97 66.2196 125.773 62.5583 121.382C58.4121 116.411 54.1614 113.342 49.7712 111.325C45.0684 109.164 39.5601 107.115 33.8818 106.206C26.103 104.959 20.1794 109.659 15.0602 111.856C10.4868 113.82 9.21745 123.142 7.91845 136.302C6.1303 154.417 8.45011 184.551 10.2862 189.856C13.2978 198.558 16.1235 206.847 18.3213 212.328C20.8539 218.644 25.2657 222.194 28.1816 226.584C31.7857 232.011 38.3982 233.529 44.071 236.455C48.8766 238.935 54.1176 239.382 63.9669 240.117C66.2098 240.284 67.2719 241.202 68.3736 241.213C73.1258 241.26 76.0525 238.297 77.8776 237.206C81.8086 234.857 82.9914 228.815 86.6472 225.154C90.8119 220.983 92.5064 213.49 94.6878 207.072C96.5351 201.637 100.531 194.131 102.367 188.25C103.746 183.833 106.011 179.486 109.119 175.096C110.832 172.677 112.6 170.706 113.69 168.88C114.223 167.989 115.505 167.779 116.606 168.316C121.866 170.88 121.731 177.25 124.104 181.821C126.719 186.857 128.308 191.5 129.952 196.072C132.083 201.995 134.885 207.571 136.349 212.334C138.077 217.958 145.102 225.461 148.763 231.15C150.782 234.287 153.521 236.455 155.159 238.281C156.685 239.98 160.087 240.117 163.189 240.122C170.023 240.134 173.976 228.815 177.083 223.696C179.844 219.148 182.745 214.564 185.672 210.174C189.215 204.86 191.887 198.122 193.351 193.55C195.166 187.88 198.092 182.775 200.29 178.385C203.411 172.149 211.97 169.971 216.903 169.05C224.532 167.626 231.679 171.791 237.549 173.791C244.909 176.3 257.593 177.25 265.502 178.549C266.786 178.76 267.876 179.092 267.892 179.097C271.605 180.335 259.15 175.452 254.579 173.989C251.888 173.127 249.273 172.525 246.725 171.977C243.52 171.288 240.142 172.876 237.588 175.063C233.344 178.697 231.745 185.647 228.626 191.681C225.266 198.183 224.795 206.825 224.592 222.156C224.507 228.585 228.785 232.071 231.701 233.896C237.289 237.394 245.93 237.563 251.8 237.568C259.628 237.575 262.395 230.635 265.875 226.798C269.18 223.155 271.537 216.779 273.011 209.451C274.315 202.969 273.006 194.109 273.379 183.69C273.698 174.771 272.282 197.705 273.192 202.649C274.288 208.603 275.198 215.244 278.843 219.645C282.084 223.559 287.607 225.855 292.907 228.601C297.53 230.996 301.869 231.709 303.694 231.901C310.201 232.585 305.892 218.226 307.355 211.643C308.647 205.834 309.18 199.218 309.734 185.729C309.996 179.352 313.916 174.378 316.486 169.796C317.061 168.772 318.301 168.152 320.126 167.779C321.951 167.406 324.483 167.406 326.33 168.672C334.022 173.945 331.477 183.454 332.387 190.026C334.295 203.811 333.669 217.721 334.579 229.308C335.312 238.635 335.862 243.383 336.043 246.677C336.422 253.595 339.128 225.899 340.427 219.136C341.608 212.989 343.535 200.752 344.445 191.369C345.525 180.225 348.994 175.101 351.565 170.892C352.177 169.89 353.379 169.248 354.661 169.056C355.944 168.864 357.391 169.226 358.679 169.955C365.326 173.717 366.555 188.168 368.556 194.795C370.386 200.856 371.291 211.934 372.946 220.177C374.375 227.294 377.144 231.687 380.789 237.36C384.494 243.126 389.926 247.406 396.125 249.796C405.506 253.412 417.682 251.09 424.988 249.445C433.63 247.5 442.85 243.789 452.212 240.681C454.229 239.766 456.399 238.681 457.698 237.579C458.997 236.477 459.359 235.392 461.924 232.082" stroke="black" stroke-width="10" stroke-linecap="round"/>
            </svg>
        </div>
    );
}

export default Signature;
